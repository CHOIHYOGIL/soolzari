<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="order">
	<select id="basketSelect" parameterType="map" resultType="_int">
		select count(*) from basket_db where cli_no=#{cliNo} and gds_no=#{gdsNo}
	</select>
	<update id="basketUpdate" parameterType="map">
		update basket_db set bas_cnt=bas_cnt+#{basCnt} where cli_no=#{cliNo} and gds_no=#{gdsNo}
	</update>
	<insert id="basketInsert" parameterType="map">
		insert into basket_db values(basket_seq.nextval,#{gdsNo},#{cliNo},#{basCnt})
	</insert>
	<select id="basketAllSelect" parameterType="_int" resultType="b">
		select
			bas_no as basNo,
			gds_no as gdsNo,
			cli_no as cliNo,
			bas_cnt as basCnt
		from basket_db
		where cli_no=#{_parameter}
	</select>
	<select id="goodsBasketSelect" parameterType="_int" resultType="g2">
		select
			gds_no as gdsNo,
			gds_name as gdsName,
			gds_pri as gdsPri,
			gds_bcnt as gdsBcnt,
			sel_no as selNo
		from goods_db
		where gds_no=#{_parameter}
	</select>
	<update id="basketPlusMinusUpdate" parameterType="map">
		<choose>
			<when test="chk==0">
				update basket_db set bas_cnt=bas_cnt-1 where bas_no=#{basNo}
			</when>
			<otherwise>
				update basket_db set bas_cnt=bas_cnt+1 where bas_no=#{basNo}
			</otherwise>
		</choose>
	</update>
	
	<delete id="basketDelete" parameterType="list">
		delete from basket_db 
			where bas_no in
			<foreach collection="list" item="basNo" open="(" close=")" separator=",">
				#{basNo}
			</foreach>
	</delete>
	
	<select id="memberInfoSelect" parameterType="_int" resultType="c2">
		select 
			cli_no as cliNo,
			cli_id as cliId,
			cli_pw as cliPw,
			cli_name as cliName,
			cli_tel as cliTel,
			cli_addr as cliAddr,
			cli_email as cliEmail,
			cli_rank as cliRank,
			cli_enroll as cliEnroll,
			cli_point as cliPoint,
			cli_age as cliAge
		 from client_db where cli_no=#{_parameter}
	</select>
	
	<update id="clientAddrUpdate" parameterType="c2">
		update client_db set cli_addr=#{cliAddr} where cli_no=#{cliNo}
	</update>
	
	<select id="paymentBasketSelect" parameterType="_int" resultType="b">
		select
			bas_no as basNo,
			gds_no as gdsNo,
			cli_no as cliNo,
			bas_cnt as basCnt
		from basket_db
		where bas_no=#{_parameter}
	</select>
	
	<insert id="purchaseInsert" parameterType="purchase">
		insert into purchase_db values(PURCHASE_SEQ.NEXTVAL,#{purTtp},#{purGet},0,#{cliNo},#{purDate})
	</insert>
	
	<select id="purchaseNoSelect" parameterType="_int" resultType="_int">
		select MAX(pur_no) from purchase_db where cli_no=#{_parameter}
	</select>
	
	<insert id="goodsListInsert" parameterType="goodsList">
		insert into goods_list_db values(goods_list_seq.nextval,#{purNo},#{gdsNo},#{gdsLPrice},#{gdsLCnt},0)
	</insert>
	
	<update id="pointUpdate" parameterType="c2">
		update client_db set cli_point=cli_point-#{cliPoint} where cli_no=#{cliNo}
	</update>
	
	<!-- 구매후에 장바구니에서 상품삭제 -->
	<delete id="basketGoodsDelete" parameterType="BasketDel">
		delete from basket_db where cli_no=#{cliNo} and gds_no in
			<foreach collection="gdsNoList" item="gdsNo" open="(" close=")" separator=",">
				#{gdsNo}
			</foreach>
	</delete>
	
	<!-- 상품상세페이지 -->
	<select id="oGoodsDetail" parameterType="_int" resultType="GoodsSellerDetail">
		select 
		    g.gds_no as gdsNo,
		    g.gds_name as gdsName,
		    g.gds_pri as gdsPri,
		    g.gds_bcnt as gdsBcnt,
		    g.goods_date as goodsDate,
		    s.sel_no as selNo,
		    s.sel_name as selName,
		    s.sel_tel as selTel,
		    s.sel_addr as selAddr
		from goods_db g,seller_db s 
		where g.sel_no=s.sel_no and g.gds_no=#{_parameter}
	</select>
	
	<!-- 펀딩상세페이지 - 펀딩정보 -->
	<select id="fundingSelect" parameterType="_int" resultType="funding">
		SELECT 
		    fund_no as fundNo,
		    fund_name as fundName,
		    fund_money as fundMoney,
		    fund_chk as fundChk,
		    fund_det as fundDet,
		    status,
		    fund_date as fundDate,
		    sel_no as selNo,
		   	fund_enrollDate as fundEnrollDate,
		    fund_enddate as fundEndDate,
		    (select sum(fnd_d_price) from FND_DET_DB where fund_no=#{_parameter}) as fundTotalMoney
		FROM FUNDING_DB where fund_no=#{_parameter}
	</select>
	
	<select id="fundingGoodsSelect" parameterType="_int" resultType="fundingGoods">
		SELECT 
			fund_no as fundNo,
		    fnd_g_no as fndGNo,
		    fnd_g_name as fndGName,
		    fnd_g_con as fndGCon,
		    fnd_g_pri as fndGPri
		FROM fnd_gds_db where fund_no=#{_parameter}
	</select>
	
	<insert id="fundReservationInsert" parameterType="fundDetailDB">
		insert into fnd_det_db values(FND_DET_DB_SEQ.NEXTVAL,#{fundNo},#{fndDCli},#{fndDPrice},#{fndGNo},0,null,to_char(sysdate,'yyyymmddhh24miss'))
	</insert>
</mapper>