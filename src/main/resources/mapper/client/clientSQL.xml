<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="client">


<insert id="insertClient" parameterType="c">
 		insert into client_db 
 		(cli_no,cli_id,cli_pw,cli_name,cli_tel,cli_addr,cli_email,cli_rank,cli_enroll,cli_point,cli_age
 	
 )
 		select client_seq.nextval, #{clientId}<choose>
 		<when test="clientPw!=null">
 		,#{clientPw}
 		</when>
 		<otherwise>
 			,'sns'
 		</otherwise>
 		</choose>,	#{clientName}
 		<choose>
 			<when test="clientTel!=null">
 			,#{clientTel}
 			</when>
 			<otherwise>
 			,'sns'
 			</otherwise>
 		</choose>
 				<choose>
 		<when test="clientAddr!=null">
 		
 		,#{clientAddr}
 		</when>
 		<otherwise>
 		,'sns'
 		</otherwise>
 		</choose>, #{clientEmail},'0',to_char(sysdate,'yyyy-mm-dd'),'3000',#{clientAge} from dual
 		where not exists( select cli_id from client_db where cli_id=#{clientId})
 		
 	</insert>
 	
 	<!-- DB 컬럼명이랑 VO 변수랑 다르면 AS 꼭쓰자 같으면 안써도된다 -->
 	<select id="checkId" parameterType="c" resultType="c">
 		select CLI_ID as clientId from client_db where CLI_ID=#{clientId}
 	</select>
 	
 	<select id="selectOneClient" parameterType="c" resultType="c">
 		select CLI_ID as clientId, CLI_NO as clientNo, CLI_NAME as clientName, CLI_EMAIL as clientEmail, CLI_TEL as clientTel, CLI_ADDR as clientAddr from client_db where CLI_ID=#{clientId} and CLI_PW=#{clientPw}
 	</select>
 	
 	
 	<insert id="reservationClass" parameterType="r">
 		insert into class_db values(class_db_seq.nextval, #{className},#{classCreator},#{classDescription},#{classPrice},#{classPerson},#{classEnroll})
 	</insert>
 	
 	<select id="getClassInfo" parameterType="r" resultType="r">
 		select cls_no as classNo, cls_name as className, sel_no as classCreator, cls_det as classDescription, cls_price as classPrice, class_person as classPerson, class_enroll as classDate, classStarttime as classStartTime from class_db  where class_enroll>TO_CHAR(SYSDATE,'yyyy-mm-dd')
 	</select>
 	
 	<select id="getClassNo" parameterType="map" resultType="Integer">
 		select  class_person as classPerson from class_db where cls_name=#{title} and class_enroll=#{date}
 	</select>
 	
 	<select id="sumPerson" parameterType="map" resultType="r">
 	<!-- null일경우 NVL 함수 사용 -->
 		select NVL(sum(class_person),0)as classPerson from class_list_db where cls_class_no=#{classNo} 
 	</select>
 	
 	<select id="getEnroll" parameterType="Integer" resultType="string">
 		select class_enroll as classDate from class_db where cls_no=#{classNo}
 	</select>
 	
 	
 	
 	<insert id="setClass_list" parameterType="map">
 		
 		insert into class_list_db (cls_l_no, cls_cli_no, cls_class_no, class_person, class_check, class_payment) select class_list_db_seq.nextval, #{clientNo}, #{classNo}, #{classPerson}, 0, #{classPayment} from dual where not exists(select cls_class_no as classNo from class_list_db where cls_cli_no=#{clientNo} and cls_class_no=#{classNo})
 	</insert>
 	
 	<select id="getGoods" parameterType="string" resultType="g">
 		select g.gds_no as goodsNo, g.gds_name as goodsName, g.gds_pri as goodsPrice, g.GDS_BCNT as goodsCount, i.FILEPATH as imagePath, ROUND(AVG(NVL(r.rev_score,0)),1) as reviewScore
from goods_db g, img_db i,review_db r
where g.gds_no=i.TYPE_NO and i.IMG_TYPE='g' and r.rev_gdsno=g.gds_no
<if test="value !=null">

	and g.gds_name like '%'||#{value}||'%'
</if>

group by g.gds_no, g.gds_name, g.gds_pri, g.GDS_BCNT, i.FILEPATH, r.rev_gdsno
order by g.gds_no DESC
 	</select>
 	
 	<select id="getTakju" resultType="g">
 	select g.gds_no as goodsNo, g.gds_name as goodsName, g.gds_pri as goodsPrice, g.GDS_BCNT as goodsCount, i.FILEPATH as imagePath, ROUND(AVG(NVL(r.rev_score,0)),1) as reviewScore
from goods_db g, img_db i,review_db r
where g.gds_no=i.TYPE_NO and i.IMG_TYPE='g' and r.rev_gdsno=g.gds_no and g.goods_type='t'

group by g.gds_no, g.gds_name, g.gds_pri, g.GDS_BCNT, i.FILEPATH, r.rev_gdsno
order by g.gds_no DESC
 	</select>
 	
 	 	<select id="getCheongju" resultType="g">
 	select g.gds_no as goodsNo, g.gds_name as goodsName, g.gds_pri as goodsPrice, g.GDS_BCNT as goodsCount, i.FILEPATH as imagePath, ROUND(AVG(NVL(r.rev_score,0)),1) as reviewScore
from goods_db g, img_db i,review_db r
where g.gds_no=i.TYPE_NO and i.IMG_TYPE='g' and r.rev_gdsno=g.gds_no and g.goods_type='c'

group by g.gds_no, g.gds_name, g.gds_pri, g.GDS_BCNT, i.FILEPATH, r.rev_gdsno
order by g.gds_no DESC
 	</select>
 		<select id="getSpirits" resultType="g">
 	select g.gds_no as goodsNo, g.gds_name as goodsName, g.gds_pri as goodsPrice, g.GDS_BCNT as goodsCount, i.FILEPATH as imagePath, ROUND(AVG(NVL(r.rev_score,0)),1) as reviewScore
from goods_db g, img_db i,review_db r
where g.gds_no=i.TYPE_NO and i.IMG_TYPE='g' and r.rev_gdsno=g.gds_no and g.goods_type='s'

group by g.gds_no, g.gds_name, g.gds_pri, g.GDS_BCNT, i.FILEPATH, r.rev_gdsno
order by g.gds_no DESC
 	</select>
 	
 	<select id="getWine" resultType="g">
 	select g.gds_no as goodsNo, g.gds_name as goodsName, g.gds_pri as goodsPrice, g.GDS_BCNT as goodsCount, i.FILEPATH as imagePath, ROUND(AVG(NVL(r.rev_score,0)),1) as reviewScore
from goods_db g, img_db i,review_db r
where g.gds_no=i.TYPE_NO and i.IMG_TYPE='g' and r.rev_gdsno=g.gds_no and g.goods_type='w'

group by g.gds_no, g.gds_name, g.gds_pri, g.GDS_BCNT, i.FILEPATH, r.rev_gdsno
order by g.gds_no DESC
 	</select>
 	<select id="getFruit" resultType="g">
 	select g.gds_no as goodsNo, g.gds_name as goodsName, g.gds_pri as goodsPrice, g.GDS_BCNT as goodsCount, i.FILEPATH as imagePath, ROUND(AVG(NVL(r.rev_score,0)),1) as reviewScore
from goods_db g, img_db i,review_db r
where g.gds_no=i.TYPE_NO and i.IMG_TYPE='g' and r.rev_gdsno=g.gds_no and g.goods_type='f'

group by g.gds_no, g.gds_name, g.gds_pri, g.GDS_BCNT, i.FILEPATH, r.rev_gdsno
order by g.gds_no DESC
 	</select>
 	
 	<insert id="setSubscribe" parameterType="s">
 		insert into subscribe_db values(subscribe_db_seq.nextval, #{subscribeName}, #{subscribeDept},#{subscribePrice})
 	</insert>
 	
 	<update id="setUsergrade" parameterType="string">
 		update client_db set cli_rank =1 where cli_id=#{id}
 	</update>
 	
 	<select id="checkUser" parameterType="cl" resultType="cl">
 		select cls_l_no as classListNo  from class_list_db where cls_cli_no=#{clientNo} and cls_class_no=#{classNo}
 	</select>
 	
 	<select id="findSeller" parameterType="Integer" resultType="string">
 		select sel_name as selName from seller_db where sel_no=#{selNo}
 	</select>

</mapper>
